<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inventory - KGL</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <style>
      :root {
        --primary-green: #2e7d32;
        --primary-light: #4caf50;
        --danger-red: #dc3545;
        --warning-orange: #fd7e14;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
      }

      /* Sidebar */
      .sidebar {
        background: linear-gradient(180deg, #1b5e20 0%, #2e7d32 100%);
        color: white;
        min-height: 100vh;
        position: fixed;
        width: 250px;
        transition: all 0.3s;
      }

      .nav-link {
        color: rgba(255, 255, 255, 0.8);
        padding: 12px 20px;
        margin: 5px 10px;
        border-radius: 8px;
        transition: all 0.3s;
      }

      .nav-link:hover,
      .nav-link.active {
        background: rgba(255, 255, 255, 0.1);
        color: white;
      }

      .nav-link.active {
        background: rgba(255, 255, 255, 0.15);
        border-left: 4px solid #ff9800;
      }

      .main-content {
        margin-left: 250px;
        transition: all 0.3s;
      }

      /* Header */
      .page-header {
        background: white;
        border-bottom: 1px solid #dee2e6;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      /* Stats Cards */
      .stat-card {
        border: none;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s;
        height: 100%;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
      }

      /* Search and Filter */
      .search-box {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        padding: 20px;
      }

      /* Table */
      .table-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        overflow: hidden;
      }

      .table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #495057;
        border-top: none;
        border-bottom: 2px solid #dee2e6;
      }

      .table td {
        vertical-align: middle;
        padding: 16px 12px;
      }

      .table tr:hover {
        background-color: #f8fff8;
      }

      /* Status Badges */
      .badge-status {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 500;
      }

      .badge-in-stock {
        background-color: rgba(40, 167, 69, 0.1);
        color: #28a745;
      }

      .badge-low-stock {
        background-color: rgba(253, 126, 20, 0.1);
        color: #fd7e14;
      }

      .badge-out-of-stock {
        background-color: rgba(220, 53, 69, 0.1);
        color: #dc3545;
      }

      /* Stock Bar */
      .stock-bar {
        height: 8px;
        border-radius: 4px;
        background: #e9ecef;
        overflow: hidden;
      }

      .stock-fill {
        height: 100%;
        border-radius: 4px;
      }

      .stock-high {
        background: linear-gradient(90deg, #28a745, #4caf50);
      }

      .stock-medium {
        background: linear-gradient(90deg, #ffc107, #fd7e14);
      }

      .stock-low {
        background: linear-gradient(90deg, #dc3545, #f44336);
      }

      /* Action Buttons */
      .btn-action {
        padding: 6px 12px;
        font-size: 13px;
        border-radius: 6px;
        border: none;
        transition: all 0.3s;
      }

      .btn-view {
        background-color: rgba(0, 123, 255, 0.1);
        color: #007bff;
      }

      .btn-view:hover {
        background-color: rgba(0, 123, 255, 0.2);
      }

      .btn-restock {
        background-color: rgba(40, 167, 69, 0.1);
        color: #28a745;
      }

      .btn-restock:hover {
        background-color: rgba(40, 167, 69, 0.2);
      }

      .btn-edit {
        background-color: rgba(108, 117, 125, 0.1);
        color: #6c757d;
      }

      .btn-edit:hover {
        background-color: rgba(108, 117, 125, 0.2);
      }

      /* Filters */
      .filter-tag {
        background: #e9ecef;
        border-radius: 20px;
        padding: 4px 12px;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        margin-right: 8px;
        margin-bottom: 8px;
      }

      .filter-tag .remove {
        margin-left: 6px;
        cursor: pointer;
        color: #6c757d;
      }

      /* Mobile */
      @media (max-width: 768px) {
        .sidebar {
          margin-left: -250px;
        }

        .sidebar.active {
          margin-left: 0;
        }

        .main-content {
          margin-left: 0;
        }

        .menu-toggle {
          display: block;
        }

        .table-responsive {
          font-size: 14px;
        }
      }

      .menu-toggle {
        display: none;
        background: none;
        border: none;
        color: var(--primary-green);
        font-size: 24px;
      }

      @media (max-width: 768px) {
        .menu-toggle {
          display: block;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <nav class="sidebar">
      <div class="sidebar-brand p-3">
        <div class="d-flex align-items-center">
          <div class="bg-white rounded-circle p-2 me-3">
            <i class="bi bi-basket text-primary-green fs-4"></i>
          </div>
          <div>
            <h5 class="mb-0 fw-bold">KGL SYSTEM</h5>
            <small class="opacity-75" id="sidebarBranch">Maganjo Branch</small>
          </div>
        </div>
      </div>

      <div class="sidebar-nav mt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="dashboard.html">
              <i class="bi bi-speedometer2 me-3"></i> Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="procurement.html">
              <i class="bi bi-truck me-3"></i> Procurement
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="sales.html">
              <i class="bi bi-cart-check me-3"></i> Sales
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="inventory.html">
              <i class="bi bi-box-seam me-3"></i> Inventory
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="credit-sales.html">
              <i class="bi bi-credit-card me-3"></i> Credit Sales
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="reports.html">
              <i class="bi bi-bar-chart me-3"></i> Reports
            </a>
          </li>
          <li class="nav-item mt-4">
            <a class="nav-link text-warning" href="#" id="logoutBtn">
              <i class="bi bi-box-arrow-left me-3"></i> Logout
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Page Header -->
      <div class="page-header">
        <div class="container-fluid">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <button class="menu-toggle me-3" id="menuToggle">
                <i class="bi bi-list"></i>
              </button>
              <h4 class="mb-1 d-inline-block">
                <i class="bi bi-box-seam text-primary-green me-2"></i>
                Inventory Management
              </h4>
              <p class="text-muted mb-0" id="userInfo">
                Manager: John Manager • Maganjo Branch
              </p>
            </div>
            <div class="d-flex align-items-center gap-3">
              <span class="badge bg-primary-green">
                <i class="bi bi-clock me-1"></i>
                <span id="currentTime">Loading...</span>
              </span>
              <button
                class="btn btn-primary-green"
                data-bs-toggle="modal"
                data-bs-target="#stockAlertModal"
              >
                <i class="bi bi-bell me-2"></i>
                <span class="badge bg-danger rounded-circle" id="alertCount"
                  >3</span
                >
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Stats Overview -->
      <div class="container-fluid p-4">
        <div class="row g-4 mb-4">
          <div class="col-xl-3 col-md-6">
            <div class="card stat-card">
              <div class="card-body">
                <div
                  class="d-flex justify-content-between align-items-start mb-3"
                >
                  <div>
                    <h6 class="card-subtitle text-muted mb-1">TOTAL ITEMS</h6>
                    <h3 class="card-title fw-bold mb-0" id="totalItems">15</h3>
                    <span class="text-muted small">products in stock</span>
                  </div>
                  <div class="stat-icon bg-primary">
                    <i class="bi bi-box"></i>
                  </div>
                </div>
                <div class="d-flex align-items-center">
                  <span
                    class="badge bg-success bg-opacity-10 text-success me-2"
                  >
                    <i class="bi bi-plus-circle me-1"></i> 2 new
                  </span>
                  <span class="text-muted small">this week</span>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-md-6">
            <div class="card stat-card">
              <div class="card-body">
                <div
                  class="d-flex justify-content-between align-items-start mb-3"
                >
                  <div>
                    <h6 class="card-subtitle text-muted mb-1">TOTAL STOCK</h6>
                    <h3 class="card-title fw-bold mb-0" id="totalStock">
                      25,430
                    </h3>
                    <span class="text-muted small">kilograms</span>
                  </div>
                  <div class="stat-icon bg-success">
                    <i class="bi bi-weight"></i>
                  </div>
                </div>
                <div class="d-flex align-items-center">
                  <span
                    class="badge bg-success bg-opacity-10 text-success me-2"
                  >
                    <i class="bi bi-arrow-up me-1"></i> 12%
                  </span>
                  <span class="text-muted small">from last week</span>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-md-6">
            <div class="card stat-card">
              <div class="card-body">
                <div
                  class="d-flex justify-content-between align-items-start mb-3"
                >
                  <div>
                    <h6 class="card-subtitle text-muted mb-1">
                      LOW STOCK ITEMS
                    </h6>
                    <h3
                      class="card-title fw-bold mb-0 text-warning"
                      id="lowStockItems"
                    >
                      3
                    </h3>
                    <span class="text-muted small">needs attention</span>
                  </div>
                  <div class="stat-icon bg-warning">
                    <i class="bi bi-exclamation-triangle"></i>
                  </div>
                </div>
                <div class="d-flex align-items-center">
                  <span class="badge bg-danger bg-opacity-10 text-danger me-2">
                    <i class="bi bi-exclamation-circle me-1"></i> Urgent
                  </span>
                  <span class="text-muted small">needs restocking</span>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-md-6">
            <div class="card stat-card">
              <div class="card-body">
                <div
                  class="d-flex justify-content-between align-items-start mb-3"
                >
                  <div>
                    <h6 class="card-subtitle text-muted mb-1">TOTAL VALUE</h6>
                    <h3 class="card-title fw-bold mb-0" id="totalValue">
                      ₵62.5M
                    </h3>
                    <span class="text-muted small">Uganda Shillings</span>
                  </div>
                  <div class="stat-icon bg-info">
                    <i class="bi bi-cash-stack"></i>
                  </div>
                </div>
                <div class="d-flex align-items-center">
                  <span
                    class="badge bg-success bg-opacity-10 text-success me-2"
                  >
                    <i class="bi bi-arrow-up me-1"></i> 8%
                  </span>
                  <span class="text-muted small">from last month</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Search and Filters -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="search-box">
              <div class="row g-3 align-items-center">
                <div class="col-md-4">
                  <div class="input-group">
                    <span class="input-group-text bg-light border-end-0">
                      <i class="bi bi-search text-muted"></i>
                    </span>
                    <input
                      type="text"
                      class="form-control border-start-0"
                      id="searchInput"
                      placeholder="Search produce..."
                    />
                  </div>
                </div>
                <div class="col-md-3">
                  <select class="form-select" id="typeFilter">
                    <option value="">All Types</option>
                    <option value="Cereals">Cereals</option>
                    <option value="Legumes">Legumes</option>
                    <option value="Grains">Grains</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <select class="form-select" id="statusFilter">
                    <option value="">All Status</option>
                    <option value="in_stock">In Stock</option>
                    <option value="low_stock">Low Stock</option>
                    <option value="out_of_stock">Out of Stock</option>
                  </select>
                </div>
                <div class="col-md-2">
                  <button class="btn btn-primary-green w-100" id="applyFilters">
                    <i class="bi bi-funnel me-2"></i> Filter
                  </button>
                </div>
              </div>

              <!-- Active Filters -->
              <div class="mt-3" id="activeFilters">
                <small class="text-muted me-2">Active filters:</small>
                <div class="d-inline-flex flex-wrap">
                  <!-- Filters will appear here -->
                </div>
                <button
                  class="btn btn-sm btn-link text-danger"
                  id="clearFilters"
                >
                  Clear All
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Inventory Table -->
        <div class="row">
          <div class="col-12">
            <div class="table-card">
              <div class="card-body">
                <div
                  class="d-flex justify-content-between align-items-center mb-4"
                >
                  <h5 class="card-title mb-0">
                    <i class="bi bi-list-check text-primary-green me-2"></i>
                    All Inventory Items
                  </h5>
                  <div class="d-flex gap-2">
                    <button
                      class="btn btn-outline-primary-green btn-sm"
                      onclick="exportToCSV()"
                    >
                      <i class="bi bi-download me-2"></i> Export
                    </button>
                    <button
                      class="btn btn-primary-green btn-sm"
                      data-bs-toggle="modal"
                      data-bs-target="#addStockModal"
                    >
                      <i class="bi bi-plus-circle me-2"></i> Add Stock
                    </button>
                  </div>
                </div>

                <div class="table-responsive">
                  <table class="table table-hover" id="inventoryTable">
                    <thead>
                      <tr>
                        <th width="5%">
                          <input
                            type="checkbox"
                            class="form-check-input"
                            id="selectAll"
                          />
                        </th>
                        <th width="25%">PRODUCE</th>
                        <th width="15%">TYPE</th>
                        <th width="15%">STOCK LEVEL</th>
                        <th width="15%">PRICE</th>
                        <th width="15%">STATUS</th>
                        <th width="10%">ACTIONS</th>
                      </tr>
                    </thead>
                    <tbody id="inventoryTableBody">
                      <!-- Inventory items will be loaded here -->
                    </tbody>
                  </table>
                </div>

                <!-- Table Footer -->
                <div
                  class="d-flex justify-content-between align-items-center mt-4"
                >
                  <div class="text-muted small">
                    Showing <span id="showingCount">0</span> of
                    <span id="totalCount">0</span> items
                  </div>
                  <nav aria-label="Page navigation">
                    <ul class="pagination pagination-sm mb-0" id="pagination">
                      <!-- Pagination will be added here -->
                    </ul>
                  </nav>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Stock Movement -->
        <div class="row mt-4">
          <div class="col-12">
            <div class="table-card">
              <div class="card-body">
                <h5 class="card-title mb-4">
                  <i class="bi bi-arrow-left-right text-primary-green me-2"></i>
                  Recent Stock Movement
                </h5>
                <div class="table-responsive">
                  <table class="table table-sm">
                    <thead>
                      <tr>
                        <th>Date</th>
                        <th>Produce</th>
                        <th>Type</th>
                        <th>Movement</th>
                        <th>Quantity</th>
                        <th>Reason</th>
                        <th>User</th>
                      </tr>
                    </thead>
                    <tbody id="stockMovementBody">
                      <!-- Stock movement will be loaded here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JavaScript -->
    <script>
      // Sample inventory data
      const inventoryData = [
        {
          id: 1,
          name: "Beans",
          type: "Legumes",
          currentStock: 8450,
          minStock: 1000,
          maxStock: 10000,
          unit: "kg",
          sellingPrice: 2500,
          costPrice: 1800,
          status: "in_stock",
          lastUpdated: "2024-03-25",
          branch: "maganjo",
          supplier: "Green Farms Ltd",
        },
        {
          id: 2,
          name: "Grain Maize",
          type: "Cereals",
          currentStock: 5600,
          minStock: 2000,
          maxStock: 8000,
          unit: "kg",
          sellingPrice: 1800,
          costPrice: 1200,
          status: "in_stock",
          lastUpdated: "2024-03-24",
          branch: "maganjo",
          supplier: "Maize Coop",
        },
        {
          id: 3,
          name: "G-nuts",
          type: "Legumes",
          currentStock: 450,
          minStock: 1000,
          maxStock: 5000,
          unit: "kg",
          sellingPrice: 3200,
          costPrice: 2500,
          status: "low_stock",
          lastUpdated: "2024-03-25",
          branch: "maganjo",
          supplier: "Nut Farmers",
        },
        {
          id: 4,
          name: "Cow peas",
          type: "Legumes",
          currentStock: 3200,
          minStock: 1500,
          maxStock: 6000,
          unit: "kg",
          sellingPrice: 3000,
          costPrice: 2200,
          status: "in_stock",
          lastUpdated: "2024-03-23",
          branch: "maganjo",
          supplier: "Peas Producers",
        },
        {
          id: 5,
          name: "Soybeans",
          type: "Legumes",
          currentStock: 2100,
          minStock: 1000,
          maxStock: 4000,
          unit: "kg",
          sellingPrice: 2800,
          costPrice: 2000,
          status: "in_stock",
          lastUpdated: "2024-03-22",
          branch: "maganjo",
          supplier: "Soya Ltd",
        },
        {
          id: 6,
          name: "Rice",
          type: "Cereals",
          currentStock: 3800,
          minStock: 2000,
          maxStock: 7000,
          unit: "kg",
          sellingPrice: 3500,
          costPrice: 2800,
          status: "in_stock",
          lastUpdated: "2024-03-21",
          branch: "maganjo",
          supplier: "Rice Millers",
        },
        {
          id: 7,
          name: "Millet",
          type: "Cereals",
          currentStock: 1800,
          minStock: 1000,
          maxStock: 4000,
          unit: "kg",
          sellingPrice: 2200,
          costPrice: 1600,
          status: "in_stock",
          lastUpdated: "2024-03-20",
          branch: "maganjo",
          supplier: "Millet Farmers",
        },
        {
          id: 8,
          name: "Sorghum",
          type: "Cereals",
          currentStock: 250,
          minStock: 1000,
          maxStock: 3000,
          unit: "kg",
          sellingPrice: 1900,
          costPrice: 1400,
          status: "low_stock",
          lastUpdated: "2024-03-25",
          branch: "maganjo",
          supplier: "Sorghum Coop",
        },
      ];

      // Sample stock movement data
      const stockMovementData = [
        {
          id: 1,
          date: "2024-03-25 10:30",
          produce: "Beans",
          type: "Legumes",
          movement: "IN",
          quantity: 2500,
          unit: "kg",
          reason: "Procurement",
          user: "John Manager",
        },
        {
          id: 2,
          date: "2024-03-25 09:15",
          produce: "Grain Maize",
          type: "Cereals",
          movement: "OUT",
          quantity: 500,
          unit: "kg",
          reason: "Sale",
          user: "Mary Attendant",
        },
        {
          id: 3,
          date: "2024-03-24 14:20",
          produce: "G-nuts",
          type: "Legumes",
          movement: "OUT",
          quantity: 200,
          unit: "kg",
          reason: "Sale",
          user: "Mary Attendant",
        },
        {
          id: 4,
          date: "2026-03-24 11:00",
          produce: "Cow peas",
          type: "Legumes",
          movement: "IN",
          quantity: 1500,
          unit: "kg",
          reason: "Procurement",
          user: "John Manager",
        },
        {
          id: 5,
          date: "2024-03-23 16:45",
          produce: "Soybeans",
          type: "Legumes",
          movement: "OUT",
          quantity: 300,
          unit: "kg",
          reason: "Sale",
          user: "Mary Attendant",
        },
      ];

      let currentFilters = {
        search: "",
        type: "",
        status: "",
      };
      let currentPage = 1;
      const itemsPerPage = 5;

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        loadUserInfo();
        loadInventory();
        loadStockMovement();
        setupEventListeners();
        updateTime();
      });

      function loadUserInfo() {
        const username = localStorage.getItem("username") || "User";
        const branch = localStorage.getItem("userBranch") || "Maganjo";

        document.getElementById("sidebarBranch").textContent =
          branch + " Branch";
        document.getElementById("userInfo").textContent =
          `User: ${username} • ${branch} Branch`;
      }

      function loadInventory() {
        const filteredData = filterInventoryData();
        renderInventoryTable(filteredData);
        updateStats(filteredData);
        updatePagination(filteredData.length);
      }

      function filterInventoryData() {
        return inventoryData.filter((item) => {
          // Search filter
          if (
            currentFilters.search &&
            !item.name
              .toLowerCase()
              .includes(currentFilters.search.toLowerCase()) &&
            !item.type
              .toLowerCase()
              .includes(currentFilters.search.toLowerCase())
          ) {
            return false;
          }

          // Type filter
          if (currentFilters.type && item.type !== currentFilters.type) {
            return false;
          }

          // Status filter
          if (currentFilters.status) {
            if (
              currentFilters.status === "in_stock" &&
              item.status !== "in_stock"
            )
              return false;
            if (
              currentFilters.status === "low_stock" &&
              item.status !== "low_stock"
            )
              return false;
            if (
              currentFilters.status === "out_of_stock" &&
              item.status !== "out_of_stock"
            )
              return false;
          }

          return true;
        });
      }

      function renderInventoryTable(data) {
        const tbody = document.getElementById("inventoryTableBody");
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const pageData = data.slice(startIndex, endIndex);

        tbody.innerHTML = "";

        if (pageData.length === 0) {
          tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="bi bi-inboxes text-muted fs-1 mb-3 d-block"></i>
                            <p class="text-muted mb-0">No inventory items found</p>
                            <small class="text-muted">Try adjusting your filters</small>
                        </td>
                    </tr>
                `;
          return;
        }

        pageData.forEach((item) => {
          const stockPercentage = (item.currentStock / item.maxStock) * 100;
          let stockBarClass = "stock-high";
          let statusBadgeClass = "badge-in-stock";
          let statusText = "In Stock";

          if (item.status === "low_stock") {
            stockBarClass = "stock-low";
            statusBadgeClass = "badge-low-stock";
            statusText = "Low Stock";
          } else if (item.currentStock === 0) {
            stockBarClass = "";
            statusBadgeClass = "badge-out-of-stock";
            statusText = "Out of Stock";
          } else if (stockPercentage < 30) {
            stockBarClass = "stock-low";
            statusBadgeClass = "badge-low-stock";
            statusText = "Low Stock";
          } else if (stockPercentage < 50) {
            stockBarClass = "stock-medium";
          }

          const row = `
                    <tr>
                        <td>
                            <input type="checkbox" class="form-check-input select-item" data-id="${item.id}">
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="bg-light rounded-circle p-2 me-3">
                                    <i class="bi bi-droplet text-primary-green"></i>
                                </div>
                                <div>
                                    <div class="fw-semibold">${item.name}</div>
                                    <small class="text-muted">Supplier: ${item.supplier}</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-light text-dark">${item.type}</span>
                        </td>
                        <td>
                            <div class="mb-2">
                                <div class="fw-semibold">${item.currentStock.toLocaleString()} ${item.unit}</div>
                                <small class="text-muted">
                                    Min: ${item.minStock.toLocaleString()} | Max: ${item.maxStock.toLocaleString()}
                                </small>
                            </div>
                            <div class="stock-bar">
                                <div class="stock-fill ${stockBarClass}" style="width: ${Math.min(stockPercentage, 100)}%"></div>
                            </div>
                        </td>
                        <td>
                            <div class="fw-semibold text-primary-green">${item.sellingPrice.toLocaleString()} UGX</div>
                            <small class="text-muted">Cost: ${item.costPrice.toLocaleString()} UGX</small>
                        </td>
                        <td>
                            <span class="badge-status ${statusBadgeClass}">
                                <i class="bi bi-circle-fill me-1"></i> ${statusText}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-action btn-view" data-id="${item.id}" title="View Details">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-action btn-restock" data-id="${item.id}" title="Restock">
                                    <i class="bi bi-plus-lg"></i>
                                </button>
                                <button class="btn btn-action btn-edit" data-id="${item.id}" title="Edit">
                                    <i class="bi bi-pencil"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;

          tbody.innerHTML += row;
        });

        // Update showing count
        document.getElementById("showingCount").textContent = pageData.length;
        document.getElementById("totalCount").textContent = data.length;
      }

      function updateStats(data) {
        const totalItems = data.length;
        const totalStock = data.reduce(
          (sum, item) => sum + item.currentStock,
          0,
        );
        const lowStockItems = data.filter(
          (item) =>
            item.status === "low_stock" || item.currentStock < item.minStock,
        ).length;
        const totalValue = data.reduce(
          (sum, item) => sum + item.currentStock * item.sellingPrice,
          0,
        );

        document.getElementById("totalItems").textContent = totalItems;
        document.getElementById("totalStock").textContent =
          totalStock.toLocaleString();
        document.getElementById("lowStockItems").textContent = lowStockItems;
        document.getElementById("totalValue").textContent =
          "₵" + (totalValue / 1000000).toFixed(1) + "M";

        // Update alert count
        document.getElementById("alertCount").textContent = lowStockItems;
      }

      function updatePagination(totalItems) {
        const pagination = document.getElementById("pagination");
        const totalPages = Math.ceil(totalItems / itemsPerPage);

        pagination.innerHTML = "";

        if (totalPages <= 1) return;

        // Previous button
        const prevLi = document.createElement("li");
        prevLi.className = `page-item ${currentPage === 1 ? "disabled" : ""}`;
        prevLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>`;
        pagination.appendChild(prevLi);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
          const li = document.createElement("li");
          li.className = `page-item ${currentPage === i ? "active" : ""}`;
          li.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
          pagination.appendChild(li);
        }

        // Next button
        const nextLi = document.createElement("li");
        nextLi.className = `page-item ${currentPage === totalPages ? "disabled" : ""}`;
        nextLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>`;
        pagination.appendChild(nextLi);

        // Add event listeners
        pagination.querySelectorAll(".page-link").forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();
            const page = parseInt(this.dataset.page);
            if (page >= 1 && page <= totalPages) {
              currentPage = page;
              loadInventory();
            }
          });
        });
      }

      function loadStockMovement() {
        const tbody = document.getElementById("stockMovementBody");
        tbody.innerHTML = "";

        stockMovementData.forEach((movement) => {
          const movementClass =
            movement.movement === "IN" ? "text-success" : "text-danger";
          const movementIcon =
            movement.movement === "IN"
              ? "bi-arrow-down-left"
              : "bi-arrow-up-right";

          const row = `
                    <tr>
                        <td>${movement.date}</td>
                        <td>${movement.produce}</td>
                        <td><span class="badge bg-light text-dark">${movement.type}</span></td>
                        <td>
                            <span class="${movementClass}">
                                <i class="bi ${movementIcon} me-1"></i> ${movement.movement}
                            </span>
                        </td>
                        <td>${movement.quantity.toLocaleString()} ${movement.unit}</td>
                        <td>${movement.reason}</td>
                        <td>${movement.user}</td>
                    </tr>
                `;

          tbody.innerHTML += row;
        });
      }

      function setupEventListeners() {
        // Mobile menu toggle
        document
          .getElementById("menuToggle")
          .addEventListener("click", function () {
            document.querySelector(".sidebar").classList.toggle("active");
            if (window.innerWidth <= 768) {
              const mainContent = document.querySelector(".main-content");
              if (
                document.querySelector(".sidebar").classList.contains("active")
              ) {
                mainContent.style.marginLeft = "250px";
              } else {
                mainContent.style.marginLeft = "0";
              }
            }
          });

        // Search input
        document
          .getElementById("searchInput")
          .addEventListener("input", function () {
            currentFilters.search = this.value;
            currentPage = 1;
            loadInventory();
            updateActiveFilters();
          });

        // Type filter
        document
          .getElementById("typeFilter")
          .addEventListener("change", function () {
            currentFilters.type = this.value;
            currentPage = 1;
            loadInventory();
            updateActiveFilters();
          });

        // Status filter
        document
          .getElementById("statusFilter")
          .addEventListener("change", function () {
            currentFilters.status = this.value;
            currentPage = 1;
            loadInventory();
            updateActiveFilters();
          });

        // Apply filters button
        document
          .getElementById("applyFilters")
          .addEventListener("click", function () {
            loadInventory();
          });

        // Clear filters
        document
          .getElementById("clearFilters")
          .addEventListener("click", function () {
            currentFilters = { search: "", type: "", status: "" };
            document.getElementById("searchInput").value = "";
            document.getElementById("typeFilter").value = "";
            document.getElementById("statusFilter").value = "";
            currentPage = 1;
            loadInventory();
            updateActiveFilters();
          });

        // Select all checkbox
        document
          .getElementById("selectAll")
          .addEventListener("change", function () {
            const checkboxes = document.querySelectorAll(".select-item");
            checkboxes.forEach((checkbox) => {
              checkbox.checked = this.checked;
            });
          });

        // Action buttons
        document.addEventListener("click", function (e) {
          if (e.target.closest(".btn-view")) {
            const btn = e.target.closest(".btn-view");
            const itemId = parseInt(btn.dataset.id);
            viewItemDetails(itemId);
          }

          if (e.target.closest(".btn-restock")) {
            const btn = e.target.closest(".btn-restock");
            const itemId = parseInt(btn.dataset.id);
            openRestockModal(itemId);
          }

          if (e.target.closest(".btn-edit")) {
            const btn = e.target.closest(".btn-edit");
            const itemId = parseInt(btn.dataset.id);
            openEditModal(itemId);
          }
        });

        // Logout
        document
          .getElementById("logoutBtn")
          .addEventListener("click", function (e) {
            e.preventDefault();
            if (confirm("Are you sure you want to logout?")) {
              localStorage.clear();
              window.location.href = "index.html";
            }
          });
      }

      function updateActiveFilters() {
        const container = document.querySelector(
          "#activeFilters .d-inline-flex",
        );
        container.innerHTML = "";

        if (currentFilters.search) {
          const tag = document.createElement("div");
          tag.className = "filter-tag";
          tag.innerHTML = `
                    Search: "${currentFilters.search}"
                    <span class="remove" onclick="removeFilter('search')">×</span>
                `;
          container.appendChild(tag);
        }

        if (currentFilters.type) {
          const tag = document.createElement("div");
          tag.className = "filter-tag";
          tag.innerHTML = `
                    Type: ${currentFilters.type}
                    <span class="remove" onclick="removeFilter('type')">×</span>
                `;
          container.appendChild(tag);
        }

        if (currentFilters.status) {
          const statusText = {
            in_stock: "In Stock",
            low_stock: "Low Stock",
            out_of_stock: "Out of Stock",
          }[currentFilters.status];

          const tag = document.createElement("div");
          tag.className = "filter-tag";
          tag.innerHTML = `
                    Status: ${statusText}
                    <span class="remove" onclick="removeFilter('status')">×</span>
                `;
          container.appendChild(tag);
        }

        // Show/hide active filters section
        const activeFiltersSection = document.getElementById("activeFilters");
        if (
          currentFilters.search ||
          currentFilters.type ||
          currentFilters.status
        ) {
          activeFiltersSection.style.display = "block";
        } else {
          activeFiltersSection.style.display = "none";
        }
      }

      function removeFilter(filterType) {
        if (filterType === "search") {
          currentFilters.search = "";
          document.getElementById("searchInput").value = "";
        } else if (filterType === "type") {
          currentFilters.type = "";
          document.getElementById("typeFilter").value = "";
        } else if (filterType === "status") {
          currentFilters.status = "";
          document.getElementById("statusFilter").value = "";
        }

        currentPage = 1;
        loadInventory();
        updateActiveFilters();
      }

      function viewItemDetails(itemId) {
        const item = inventoryData.find((i) => i.id === itemId);
        if (!item) return;

        // Create modal for details
        const modalHTML = `
                <div class="modal fade" id="itemDetailsModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">${item.name} - Details</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <table class="table table-sm">
                                            <tr>
                                                <th>Type:</th>
                                                <td>${item.type}</td>
                                            </tr>
                                            <tr>
                                                <th>Current Stock:</th>
                                                <td>${item.currentStock.toLocaleString()} ${item.unit}</td>
                                            </tr>
                                            <tr>
                                                <th>Minimum Stock:</th>
                                                <td>${item.minStock.toLocaleString()} ${item.unit}</td>
                                            </tr>
                                            <tr>
                                                <th>Maximum Stock:</th>
                                                <td>${item.maxStock.toLocaleString()} ${item.unit}</td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <table class="table table-sm">
                                            <tr>
                                                <th>Selling Price:</th>
                                                <td>${item.sellingPrice.toLocaleString()} UGX/${item.unit}</td>
                                            </tr>
                                            <tr>
                                                <th>Cost Price:</th>
                                                <td>${item.costPrice.toLocaleString()} UGX/${item.unit}</td>
                                            </tr>
                                            <tr>
                                                <th>Profit Margin:</th>
                                                <td>${(((item.sellingPrice - item.costPrice) / item.costPrice) * 100).toFixed(1)}%</td>
                                            </tr>
                                            <tr>
                                                <th>Last Updated:</th>
                                                <td>${item.lastUpdated}</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <h6>Supplier Information</h6>
                                    <p class="mb-0">${item.supplier}</p>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary-green">Print Report</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

        // Remove existing modal if any
        const existingModal = document.getElementById("itemDetailsModal");
        if (existingModal) existingModal.remove();

        // Add modal to body
        document.body.insertAdjacentHTML("beforeend", modalHTML);

        // Show modal
        const modal = new bootstrap.Modal(
          document.getElementById("itemDetailsModal"),
        );
        modal.show();
      }

      function openRestockModal(itemId) {
        const item = inventoryData.find((i) => i.id === itemId);
        if (!item) return;

        // Fill modal fields
        document.getElementById("restockItemName").value = item.name;
        document.getElementById("restockItemId").value = item.id;
        document.getElementById("restockCurrentStock").value =
          item.currentStock;
        document.getElementById("restockUnit").value = item.unit;
        document.getElementById("restockRequired").value =
          item.minStock - item.currentStock > 0
            ? item.minStock - item.currentStock
            : 0;

        // Show modal
        const modal = new bootstrap.Modal(
          document.getElementById("restockModal"),
        );
        modal.show();
      }

      function openEditModal(itemId) {
        const item = inventoryData.find((i) => i.id === itemId);
        if (!item) return;

        // Fill form fields
        document.getElementById("editItemName").value = item.name;
        document.getElementById("editItemType").value = item.type;
        document.getElementById("editMinStock").value = item.minStock;
        document.getElementById("editMaxStock").value = item.maxStock;
        document.getElementById("editSellingPrice").value = item.sellingPrice;
        document.getElementById("editCostPrice").value = item.costPrice;
        document.getElementById("editSupplier").value = item.supplier;

        // Show modal
        const modal = new bootstrap.Modal(
          document.getElementById("editItemModal"),
        );
        modal.show();
      }

      function exportToCSV() {
        const filteredData = filterInventoryData();
        const csvContent = [
          [
            "Produce",
            "Type",
            "Current Stock",
            "Min Stock",
            "Max Stock",
            "Unit",
            "Selling Price",
            "Status",
          ],
          ...filteredData.map((item) => [
            item.name,
            item.type,
            item.currentStock,
            item.minStock,
            item.maxStock,
            item.unit,
            item.sellingPrice,
            item.status === "in_stock"
              ? "In Stock"
              : item.status === "low_stock"
                ? "Low Stock"
                : "Out of Stock",
          ]),
        ]
          .map((row) => row.join(","))
          .join("\n");

        const blob = new Blob([csvContent], { type: "text/csv" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `kgl-inventory-${new Date().toISOString().split("T")[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);

        alert("Inventory exported successfully!");
      }

      function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString("en-US", {
          hour: "2-digit",
          minute: "2-digit",
          hour12: true,
        });
        document.getElementById("currentTime").textContent = timeString;

        // Update every minute
        setTimeout(updateTime, 60000);
      }

      // Handle form submissions
      document
        .getElementById("restockForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const itemId = parseInt(
            document.getElementById("restockItemId").value,
          );
          const quantity = parseInt(
            document.getElementById("restockQuantity").value,
          );
          const supplier = document.getElementById("restockSupplier").value;
          const cost = parseFloat(document.getElementById("restockCost").value);

          // Update inventory (in real app, send to API)
          const item = inventoryData.find((i) => i.id === itemId);
          if (item) {
            item.currentStock += quantity;
            item.lastUpdated = new Date().toISOString().split("T")[0];

            // Add to stock movement
            stockMovementData.unshift({
              id: stockMovementData.length + 1,
              date: new Date().toLocaleString(),
              produce: item.name,
              type: item.type,
              movement: "IN",
              quantity: quantity,
              unit: item.unit,
              reason: "Restock",
              user: localStorage.getItem("username") || "User",
            });

            loadInventory();
            loadStockMovement();

            // Show success message
            alert(
              `Successfully added ${quantity} ${item.unit} of ${item.name} to inventory.`,
            );

            // Close modal
            const modal = bootstrap.Modal.getInstance(
              document.getElementById("restockModal"),
            );
            modal.hide();

            // Reset form
            this.reset();
          }
        });

      document
        .getElementById("editItemForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const itemId = parseInt(document.getElementById("editItemId").value);
          const item = inventoryData.find((i) => i.id === itemId);

          if (item) {
            // Update item (in real app, send to API)
            item.type = document.getElementById("editItemType").value;
            item.minStock = parseInt(
              document.getElementById("editMinStock").value,
            );
            item.maxStock = parseInt(
              document.getElementById("editMaxStock").value,
            );
            item.sellingPrice = parseFloat(
              document.getElementById("editSellingPrice").value,
            );
            item.costPrice = parseFloat(
              document.getElementById("editCostPrice").value,
            );
            item.supplier = document.getElementById("editSupplier").value;
            item.lastUpdated = new Date().toISOString().split("T")[0];

            // Update status based on new stock levels
            if (item.currentStock === 0) {
              item.status = "out_of_stock";
            } else if (item.currentStock < item.minStock) {
              item.status = "low_stock";
            } else {
              item.status = "in_stock";
            }

            loadInventory();

            // Show success message
            alert(`Successfully updated ${item.name}.`);

            // Close modal
            const modal = bootstrap.Modal.getInstance(
              document.getElementById("editItemModal"),
            );
            modal.hide();
          }
        });
    </script>

    <!-- Restock Modal -->
    <div class="modal fade" id="restockModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="bi bi-plus-circle me-2"></i> Restock Item
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <form id="restockForm">
            <div class="modal-body">
              <input type="hidden" id="restockItemId" />
              <div class="mb-3">
                <label class="form-label fw-semibold">Item Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="restockItemName"
                  readonly
                />
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-semibold">Current Stock</label>
                    <div class="input-group">
                      <input
                        type="number"
                        class="form-control"
                        id="restockCurrentStock"
                        readonly
                      />
                      <span class="input-group-text" id="restockUnit">kg</span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-semibold"
                      >Required to Reach Min</label
                    >
                    <div class="input-group">
                      <input
                        type="number"
                        class="form-control"
                        id="restockRequired"
                        readonly
                      />
                      <span class="input-group-text">kg</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold"
                  >Quantity to Add <span class="text-danger">*</span></label
                >
                <div class="input-group">
                  <input
                    type="number"
                    class="form-control"
                    id="restockQuantity"
                    min="1"
                    required
                  />
                  <span class="input-group-text">kg</span>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Supplier</label>
                <input
                  type="text"
                  class="form-control"
                  id="restockSupplier"
                  placeholder="Enter supplier name"
                />
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Cost per kg (UGX)</label>
                <input
                  type="number"
                  class="form-control"
                  id="restockCost"
                  min="0"
                  step="100"
                />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary-green">
                Add Stock
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Edit Item Modal -->
    <div class="modal fade" id="editItemModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="bi bi-pencil me-2"></i> Edit Item Details
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <form id="editItemForm">
            <input type="hidden" id="editItemId" />
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label fw-semibold">Item Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="editItemName"
                  readonly
                />
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-semibold">Type</label>
                    <select class="form-select" id="editItemType">
                      <option value="Cereals">Cereals</option>
                      <option value="Legumes">Legumes</option>
                      <option value="Grains">Grains</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-semibold">Supplier</label>
                    <input type="text" class="form-control" id="editSupplier" />
                  </div>
                </div>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-semibold">Minimum Stock</label>
                    <input
                      type="number"
                      class="form-control"
                      id="editMinStock"
                      min="1"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-semibold">Maximum Stock</label>
                    <input
                      type="number"
                      class="form-control"
                      id="editMaxStock"
                      min="1"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-semibold"
                      >Cost Price (UGX/kg)</label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="editCostPrice"
                      min="0"
                      step="100"
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-semibold"
                      >Selling Price (UGX/kg)</label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="editSellingPrice"
                      min="0"
                      step="100"
                      required
                    />
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary-green">
                Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Stock Alerts Modal -->
    <div class="modal fade" id="stockAlertModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="bi bi-exclamation-triangle text-warning me-2"></i> Stock
              Alerts
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="alert alert-warning">
              <i class="bi bi-exclamation-triangle me-2"></i>
              The following items require immediate attention:
            </div>
            <div class="table-responsive">
              <table class="table table-sm">
                <thead>
                  <tr>
                    <th>Item</th>
                    <th>Current Stock</th>
                    <th>Min Stock</th>
                    <th>Shortfall</th>
                    <th>Status</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="alertsTableBody">
                  <!-- Alerts will be loaded dynamically -->
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary-green"
              onclick="generateRestockOrder()"
            >
              <i class="bi bi-printer me-2"></i> Generate Restock Order
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Stock Modal -->
    <div class="modal fade" id="addStockModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="bi bi-plus-circle me-2"></i> Add New Stock Item
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <form id="addStockForm">
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label fw-semibold"
                  >Item Name <span class="text-danger">*</span></label
                >
                <input
                  type="text"
                  class="form-control"
                  id="newItemName"
                  required
                />
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-semibold"
                      >Type <span class="text-danger">*</span></label
                    >
                    <select class="form-select" id="newItemType" required>
                      <option value="">Select Type</option>
                      <option value="Cereals">Cereals</option>
                      <option value="Legumes">Legumes</option>
                      <option value="Grains">Grains</option>
                      <option value="Seeds">Seeds</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-semibold"
                      >Unit <span class="text-danger">*</span></label
                    >
                    <select class="form-select" id="newItemUnit" required>
                      <option value="kg">Kilograms (kg)</option>
                      <option value="g">Grams (g)</option>
                      <option value="bags">Bags</option>
                      <option value="sacks">Sacks</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-semibold">Initial Stock</label>
                    <input
                      type="number"
                      class="form-control"
                      id="newItemStock"
                      min="0"
                      value="0"
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-semibold"
                      >Selling Price (UGX)
                      <span class="text-danger">*</span></label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="newItemPrice"
                      min="0"
                      step="100"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Supplier</label>
                <input type="text" class="form-control" id="newItemSupplier" />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary-green">
                Add Item
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Additional functions for modals
      document
        .getElementById("stockAlertModal")
        .addEventListener("show.bs.modal", function () {
          const alerts = inventoryData.filter(
            (item) =>
              item.currentStock < item.minStock || item.status === "low_stock",
          );

          const tbody = document.getElementById("alertsTableBody");
          tbody.innerHTML = "";

          if (alerts.length === 0) {
            tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-3 text-muted">
                            No stock alerts at the moment
                        </td>
                    </tr>
                `;
            return;
          }

          alerts.forEach((item) => {
            const shortfall = item.minStock - item.currentStock;
            const row = `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.currentStock.toLocaleString()} ${item.unit}</td>
                        <td>${item.minStock.toLocaleString()} ${item.unit}</td>
                        <td class="text-danger fw-semibold">${shortfall > 0 ? shortfall.toLocaleString() : "0"} ${item.unit}</td>
                        <td><span class="badge-status badge-low-stock">Low Stock</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary-green" 
                                    onclick="openRestockModal(${item.id})" 
                                    data-bs-dismiss="modal">
                                Restock
                            </button>
                        </td>
                    </tr>
                `;
            tbody.innerHTML += row;
          });
        });

      document
        .getElementById("addStockForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const newItem = {
            id: inventoryData.length + 1,
            name: document.getElementById("newItemName").value,
            type: document.getElementById("newItemType").value,
            currentStock:
              parseInt(document.getElementById("newItemStock").value) || 0,
            minStock: 1000,
            maxStock: 10000,
            unit: document.getElementById("newItemUnit").value,
            sellingPrice: parseFloat(
              document.getElementById("newItemPrice").value,
            ),
            costPrice:
              parseFloat(document.getElementById("newItemPrice").value) * 0.7, // 30% margin
            status:
              parseInt(document.getElementById("newItemStock").value) > 0
                ? "in_stock"
                : "out_of_stock",
            lastUpdated: new Date().toISOString().split("T")[0],
            branch: localStorage.getItem("userBranch") || "maganjo",
            supplier:
              document.getElementById("newItemSupplier").value ||
              "Not specified",
          };

          // Add to inventory (in real app, send to API)
          inventoryData.push(newItem);

          // Add to stock movement
          if (newItem.currentStock > 0) {
            stockMovementData.unshift({
              id: stockMovementData.length + 1,
              date: new Date().toLocaleString(),
              produce: newItem.name,
              type: newItem.type,
              movement: "IN",
              quantity: newItem.currentStock,
              unit: newItem.unit,
              reason: "Initial Stock",
              user: localStorage.getItem("username") || "User",
            });
          }

          loadInventory();
          loadStockMovement();

          alert(`Successfully added ${newItem.name} to inventory.`);

          // Close modal and reset form
          const modal = bootstrap.Modal.getInstance(
            document.getElementById("addStockModal"),
          );
          modal.hide();
          this.reset();
        });

      function generateRestockOrder() {
        const alerts = inventoryData.filter(
          (item) => item.currentStock < item.minStock,
        );

        if (alerts.length === 0) {
          alert("No items need restocking at the moment.");
          return;
        }

        let orderContent = `KGL RESTOCK ORDER\nDate: ${new Date().toLocaleDateString()}\n\n`;
        orderContent += "ITEMS TO RESTOCK:\n\n";

        let totalCost = 0;

        alerts.forEach((item, index) => {
          const required = item.minStock - item.currentStock;
          const estimatedCost = required * item.costPrice;
          totalCost += estimatedCost;

          orderContent += `${index + 1}. ${item.name} (${item.type})\n`;
          orderContent += `   Required: ${required.toLocaleString()} ${item.unit}\n`;
          orderContent += `   Estimated Cost: ${estimatedCost.toLocaleString()} UGX\n`;
          orderContent += `   Supplier: ${item.supplier}\n\n`;
        });

        orderContent += `TOTAL ESTIMATED COST: ${totalCost.toLocaleString()} UGX\n\n`;
        orderContent += `Generated by: ${localStorage.getItem("username") || "User"}`;

        // Create download
        const blob = new Blob([orderContent], { type: "text/plain" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `restock-order-${new Date().toISOString().split("T")[0]}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);

        alert("Restock order generated successfully!");
      }
    </script>
  </body>
</html>
